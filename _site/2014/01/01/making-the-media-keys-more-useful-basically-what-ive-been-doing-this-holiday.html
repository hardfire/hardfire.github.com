<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Making the media keys more useful, basically what I've been doing this holiday</title>

	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/bootstrap-responsive.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">

    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
	  <div class="container">
		  <div class="row">
			  <div class="span7 offset1">
				  <div class="meta">
<h1>Making the media keys more useful, basically what I've been doing this holiday</h1>
	<div class="clearfix">
		<p class="muted"><small>Jan 2014</small></p>
	</div>
</div>
<div class="content">
	<h3>A little Context <em>(is always better)</em></h3>

<p>It all started with me getting very used to the spotify web player and for some weird reason never using the desktop player. For some reason, if I can do something (effectively) in the browser, I try to do it in the browser. I must say that the browser based web players are getting really sophisticated and amazing but very quickly I started missing the ease of using the media keys in my latop. I didnt want to go between a stack of browser windows and a heap of browser tabs and find that one tab which was playing the song, plus who wants to do that when you've already seen the better part :D</p>

<h3>The plan, that was</h3>

<p>Well, the plan was eithe search for a plugin or gear up and code a quick one hour firefox plugin that would grab the key press event for the media keys and then find the spotify tab and pause/play it depending on the situation. That one line shows how naive and prepared I was for this.</p>

<h3>The obvious problem(s) in the plan</h3>

<ol>
<li>Sadly, the media keys don't emit the keyPress event in browsers :'(</li>
<li>This solution would not be global and would mostly work in the context of the browser (which i could have lived with, if it worked atleast)</li>
</ol>


<h3>What i ended up doing</h3>

<p>The soluton consists of two parts, one is a server that grabs the media key events and broadcasts it over a websocket server and the other is a firefox plugin that connects to the websockets server and basically does the magic. Turns out grabbing the media keys (in the server) was not really a piece of cake, but a good learning process as I eventually had to read about Objective C and the Foundation framework, but eventualy wrote a node application that internally does the ObjC Black Magic</p>

<blockquote><p><a href="http://www.codinghorror.com/blog/2007/07/the-principle-of-least-power.html">Atwoods Law</a> : any application that can be written in JavaScript, will eventually be written in JavaScript.</p></blockquote>

<p>Coming to the plugin, I was a little adventorous and decided to write it without the SDK but i soon hit a wall when I figured out that connecting to websocket server from a plugin is not that simple as you dont have the context and basically following a stackoverflow answer I learned that you do it by creating a hidden page and then do it from there. Luckily, SDK has page-workers which is perfectly made for this so long story short, I used the SDK :D</p>

<h3>Pre-Conlusion</h3>

<p>The plugin works and It has been extended to work with saavn, gaana and soundcloud.</p>

<h3>Things on the top of my head</h3>

<ol>
<li>As of now it doesn't prefer between the services and finds the first tab that matches one of the sites. It has not been much of a problem as I keep one site open at a time.</li>
<li>Another thing that I would like to change is to bundle the server with the plugin but then it would make it a little bulky as i would like only one instance of the server running even if multiple browsers are open (maybe use locks) and basically make sure if the browser close and other services are listening to it, the server shouldn't exit.</li>
<li>Yesterday i was away from my laptop and wanted to control the player, since we have a server tht listens to the keys it would not be hard to make them emit it :D</li>
<li>Extend this to work for windows and linux only if someone would actually be using it, as of now it works perfectly on my macbook.</li>
</ol>


<h3>Conclusion</h3>

<p>The source is on <a href="https://github.com/hardfire/mekespo">github</a> (please give it some love :D) and if one would like to contribute/change I would love pull requests. If you are experienced, are a pro, have a different Idea, think i am a fool and could have done this easily, please do let me know, I am open to learning too.</p>

<blockquote><p>First do it, then do it right, then do it better - I heard it from <a href="http://addyosmani.com/blog/">Addy Osmani</a></p></blockquote>

</div>
<ul id="tag_list" class="unstyled"><li class="inline tag_list_item"><a class="tag_list_link" href="/tag/javascript">javascript</a></li><li class="inline tag_list_item"><a class="tag_list_link" href="/tag/firefox">firefox</a></li><li class="inline tag_list_item"><a class="tag_list_link" href="/tag/spotify">spotify</a></li><li class="inline tag_list_item"><a class="tag_list_link" href="/tag/plugin">plugin</a></li><li class="inline tag_list_item"><a class="tag_list_link" href="/tag/media-keys">media-keys</a></li></ul>

    
				  
				  <div>
					<br />
					<hr />
					<br />
					<div id="disqus_thread"></div>
					<script type="text/javascript">
						/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
						var disqus_shortname = 'avinashme'; // required: replace example with your forum shortname

						/* * * DON'T EDIT BELOW THIS LINE * * */
						(function() {
							var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
							dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
							(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
						})();
					</script>
					<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
				  </div>
				  
			  </div>
			  <div class="span3">
				  <div align="center">
					  <a href="/"><img src="/assets/img/me.jpg" alt="That's Me!"></a>
					  <h4 class="muted">Avinash Kundaliya</h4>
					  <div class="links">
						  <a href="/about.html"> About </a> | <a href="http://twitter.com/hardfire">Rant</a> | <a href="https://github.com/hardfire">Code</a>
					  </div>
				  </div>
			  </div>
		  </div>
	  </div>

	  <script type="text/javascript">
		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-36082124-1']);
		  _gaq.push(['_trackPageview']);

		  (function() {
			  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();
	  </script>
	  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
	  <script src="/assets/js/bootstrap.min.js"></script>
  </body>
</html>
